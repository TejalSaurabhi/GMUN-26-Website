<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sticky heading + persistent subheading + horizontal columns</title>
<style>
  :root{
    --heading-height: 0px;
    --subheading-height: 0px;
    --col-top-offset: 0px; /* heading + subheading */
    --col-width: 30%;
    --gap: 2%;
  }

  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background:#f4f6f8;
    color:#111;
  }

  .hero{
    padding:36px 20px;
    background: linear-gradient(180deg,#355c7d,#6c5b7b);
    color:white;
  }

  /* main heading - sticks to top */
  .main-heading{
    position: sticky;
    top: 0;
    margin: 0;
    padding: 14px 18px;
    font-size: 24px;
    z-index: 60;
    background: rgba(255,255,255,0.02);
    backdrop-filter: blur(4px);
  }

  /* subheading - stays under main heading and always sticky */
  .subheading{
    position: sticky;
    /* pinned directly below the main heading */
    top: calc(var(--heading-height));
    margin: 0;
    padding: 10px 18px;
    font-size: 15px;
    color: #222;
    background: linear-gradient(180deg,#fff,#fbfbfd);
    z-index: 55;
    border-bottom: 1px solid rgba(0,0,0,0.04);
  }

  .note{
    max-width:1200px;
    margin:12px auto;
    padding:8px 16px;
    font-size:14px;
    color:#444;
  }

  /* container for the horizontally arranged columns */
  .cols-container{
    max-width:1200px;
    margin: 18px auto;
    padding: 0 18px 60px 18px;
  }

  .cols-wrap{
    display:flex;
    gap: var(--gap);
    align-items:flex-start;
  }

  .col{
    width: var(--col-width);
    min-height: 1100px;
    background: #fff;
    border-radius:10px;
    padding:16px;
    box-sizing:border-box;
    box-shadow: 0 8px 20px rgba(20,30,50,0.06);

    /* sticky candidate: will stick at the computed offset below heading+subheading */
    position: sticky;
    top: calc(var(--col-top-offset));
    z-index: 30;
    transition: transform .15s ease, box-shadow .15s ease;
  }

  #c1 { border-left:4px solid #ff7a7a; }
  #c2 { border-left:4px solid #7abaff; }
  #c3 { border-left:4px solid #7affb3; }

  /* when the container has .unstuck remove all columns' stickiness */
  .cols-container.unstuck .col{
    position: static !important;
    top: auto !important;
  }

  .card{
    margin-bottom:12px;
    padding:10px;
    border-radius:6px;
    border:1px solid rgba(0,0,0,0.04);
    background:linear-gradient(180deg,#fff,#fafafa);
  }

  @media (max-width:900px){
    :root{ --col-width: 100%; }
    .cols-wrap{ flex-direction: column; gap:12px; }
    .col{ min-height:600px; }
  }
</style>
</head>
<body>

  <div class="hero">
    <p style="margin:0 0 6px 0; opacity:.95">Demo top area — scroll down to see the behavior.</p>
    <p style="margin:0; opacity:.85">This gives vertical space so the heading/subheading can become sticky.</p>
  </div>

  <h1 id="heading" class="main-heading">Main heading (sticky at top)</h1>
  <h2 id="subheading" class="subheading">Subheading — stays visible under heading (always sticky)</h2>

  <div class="note">
    Behavior: heading pins to top → subheading below it stays pinned → columns are horizontal.
    Columns stick under heading+subheading progressively (c1 then c2). When c3 reaches the sticky threshold, ALL columns unstick.
  </div>

  <div id="colsContainer" class="cols-container">
    <div class="cols-wrap">
      <div id="c1" class="col">
        <h3>c1</h3>
        <div class="card">c1 block 1</div>
        <div class="card">c1 block 2</div>
        <div class="card">c1 block 3</div>
        <div class="card">c1 block 4</div>
        <div class="card">c1 block 5</div>
      </div>

      <div id="c2" class="col">
        <h3>c2</h3>
        <div class="card">c2 block 1</div>
        <div class="card">c2 block 2</div>
        <div class="card">c2 block 3</div>
        <div class="card">c2 block 4</div>
        <div class="card">c2 block 5</div>
      </div>

      <div id="c3" class="col">
        <h3>c3</h3>
        <div class="card">c3 block 1</div>
        <div class="card">c3 block 2</div>
        <div class="card">c3 block 3</div>
        <div class="card">c3 block 4</div>
        <div class="card">c3 block 5</div>
      </div>
    </div>
  </div>

<script>
(function(){
  const heading = document.getElementById('heading');
  const sub = document.getElementById('subheading');
  const c3 = document.getElementById('c3');
  const colsContainer = document.getElementById('colsContainer');

  function setHeights(){
    const h = Math.ceil(heading.getBoundingClientRect().height);
    const s = Math.ceil(sub.getBoundingClientRect().height);
    // update css variables
    document.documentElement.style.setProperty('--heading-height', `${h}px`);
    document.documentElement.style.setProperty('--subheading-height', `${s}px`);
    // columns stick below heading + subheading
    const topOffset = h + s;
    document.documentElement.style.setProperty('--col-top-offset', `${topOffset}px`);
  }

  // run at load and on resize (subheading text/size may change)
  setHeights();
  window.addEventListener('resize', setHeights);

  // throttle with requestAnimationFrame
  let ticking = false;
  function onScroll(){
    if(!ticking){
      window.requestAnimationFrame(()=>{
        checkUnstick();
        ticking = false;
      });
      ticking = true;
    }
  }

  function checkUnstick(){
    // threshold: when c3's top <= columns sticky top offset, unstick all columns
    const topOffset = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--col-top-offset')) || 0;
    const c3Top = c3.getBoundingClientRect().top;
    if(c3Top <= topOffset + 0.5){
      colsContainer.classList.add('unstuck');
    } else {
      colsContainer.classList.remove('unstuck');
    }
  }

  window.addEventListener('scroll', onScroll, { passive: true });

  // initial check
  checkUnstick();
})();
</script>

</body>
</html>
